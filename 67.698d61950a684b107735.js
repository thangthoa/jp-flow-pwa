/*! @version pwa-studio: 0.0.1, @magento/venia-ui: ~10.3.0, @magento/venia-sample-payments-checkmo: ^0.0.12, @magento/upward-security-headers: ~1.0.14, @magento/pwa-theme-venia: ~1.4.0, @magento/pwa-buildpack: ~11.4.3, @magento/peregrine: ~13.1.1, @magento/pagebuilder: ~8.2.1, @magento/eslint-config: ~1.5.0, @magento/babel-preset-peregrine: ~1.2.3, @apollo/client: ~3.6.9 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{"1yLg":function(a,e,r){"use strict"
r.r(e),r.d(e,"default",function(){return X})
var t,n,c,i,o=r("q1tI"),d=r.n(o),l=r("dDsW"),s=r("kriW"),g=r("8UhI"),f=r("QMhA"),u=r("+TN3"),m=r("Lm/n"),C=r("pZLH"),p=r("RVCY"),b=r("y1Xp"),y=r("VkAN"),_=r.n(y),v=r("UYTu"),h=r("JXKe"),k=r("jSIv")
var E={getAppliedGiftCardsQuery:Object(v.a)(t||(t=_()(["\n    query getAppliedGiftCards($cartId: String!) {\n        cart(cart_id: $cartId) {\n            id\n            ...GiftCardFragment\n        }\n    }\n    ","\n"])),k.a),getGiftCardBalanceQuery:Object(v.a)(n||(n=_()(["\n    query getGiftCardBalance($giftCardCode: String!) {\n        giftCardAccount(input: { gift_card_code: $giftCardCode }) {\n            balance {\n                currency\n                value\n            }\n            code\n            expiration_date\n            id: code\n        }\n    }\n"]))),applyGiftCardMutation:Object(v.a)(c||(c=_()(['\n    mutation applyGiftCardToCart($cartId: String!, $giftCardCode: String!) {\n        applyGiftCardToCart(\n            input: { cart_id: $cartId, gift_card_code: $giftCardCode }\n        ) {\n            cart {\n                id\n                ...CartPageFragment\n                # If this mutation causes "free" to become available we need to know.\n                available_payment_methods {\n                    code\n                    title\n                }\n            }\n        }\n    }\n    ',"\n"])),h.a),removeGiftCardMutation:Object(v.a)(i||(i=_()(['\n    mutation removeGiftCard($cartId: String!, $giftCardCode: String!) {\n        removeGiftCardFromCart(\n            input: { cart_id: $cartId, gift_card_code: $giftCardCode }\n        ) {\n            cart {\n                id\n                ...CartPageFragment\n                # If this mutation causes "free" to become available we need to know.\n                available_payment_methods {\n                    code\n                    title\n                }\n            }\n        }\n    }\n    ',"\n"])),h.a)}
const G="apply",O="check",j="remove"
var T=r("J3e4"),B=r("kXdO"),w=r("fq0T"),I=r("ACyH"),N=r("U2T0"),x=r("oTwF"),D=r("6QXU"),F=r("fTop"),L=r("b1jg"),M=r("LboF"),P=r.n(M),J=r("zLjX"),A={injectType:"singletonStyleTag",insert:"head",singleton:!0},R=(P()(J.a,A),J.a.locals||{})
var $=r("ZKBY"),S=r("GVTQ"),H={injectType:"singletonStyleTag",insert:"head",singleton:!0},K=(P()(S.a,H),S.a.locals||{})
var U=a=>{const{code:e,currentBalance:r,isRemovingCard:t,removeGiftCard:n}=a,{removeGiftCardWithCode:c}=(a=>{const{code:e,removeGiftCard:r}=a
return{removeGiftCardWithCode:Object(o.useCallback)(()=>{r(e)},[e,r])}})({code:e,removeGiftCard:n}),i=Object(b.a)(K,a.classes)
return d.a.createElement(o.Fragment,null,d.a.createElement("div",{className:i.card_info},d.a.createElement("span",{className:i.code},e),d.a.createElement("span",{className:i.balance},d.a.createElement(s.a,{id:"giftCard.balance",defaultMessage:"Balance: "}),d.a.createElement($.a,{value:r.value,currencyCode:r.currency}))),d.a.createElement(D.a,{disabled:t,onClick:c},d.a.createElement(s.a,{id:"giftCard.remove",defaultMessage:"Remove"})))}
const W=d.a.createElement(x.a,{src:f.a,attrs:{width:18}}),q=a=>{const e=(a=>{const e=Object(b.a)(E,a.operations),{getAppliedGiftCardsQuery:r,getGiftCardBalanceQuery:t,applyGiftCardMutation:n,removeGiftCardMutation:c}=e,{setIsCartUpdating:i}=a,[{cartId:d}]=Object(p.b)(),l=Object(g.n)(),s=Object(u.b)(r,{fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first",skip:!d,variables:{cartId:d}}),[f,y]=Object(m.a)(t,{fetchPolicy:"no-cache"}),[_,v]=Object(C.a)(n),[h,k]=Object(C.a)(c),[T,B]=Object(o.useState)(null),w=Object(o.useCallback)(async()=>{B(G)
const a=l.getValue("card")
await _({variables:{cartId:d,giftCardCode:a}}),l.reset()},[l,_,d]),I=Object(o.useCallback)(()=>{B(O)
const a=l.getValue("card")
f({variables:{giftCardCode:a}})},[l,f]),N=Object(o.useCallback)(()=>{},[I]),x=Object(o.useCallback)(async a=>{B(j)
try{await h({variables:{cartId:d,giftCardCode:a}})}catch(a){}},[d,h]),{called:D,loading:F}=v,{called:L,loading:M}=k
Object(o.useEffect)(()=>{(D||L)&&i(F||M)},[D,F,L,M,i])
const P=Object(o.useCallback)(()=>{},[w]),J=T===O&&Boolean(y.data),A=T===G&&v.error||T===O&&y.error
return{applyGiftCard:w,checkBalanceData:y.data&&y.data.giftCardAccount,checkGiftCardBalance:I,checkGiftCardBalanceKeyPress:N,errorLoadingGiftCards:Boolean(s.error),errorRemovingCard:Boolean(k.error),giftCardsData:s.data&&s.data.cart.applied_gift_cards||[],handleEnterKeyPress:P,isLoadingGiftCards:s.loading,isApplyingCard:F,isCheckingBalance:y.loading,isRemovingCard:M,removeGiftCard:x,shouldDisplayCardBalance:J,shouldDisplayCardError:A}})({setIsCartUpdating:a.setIsCartUpdating}),{applyGiftCard:r,checkBalanceData:t,checkGiftCardBalance:n,checkGiftCardBalanceKeyPress:c,errorLoadingGiftCards:i,errorRemovingCard:f,giftCardsData:y,handleEnterKeyPress:_,isLoadingGiftCards:v,isApplyingCard:h,isCheckingBalance:k,isRemovingCard:x,removeGiftCard:M,shouldDisplayCardBalance:P,shouldDisplayCardError:J}=e,A=Object(b.a)(R,a.classes),{formatMessage:$}=Object(l.a)(),[,{addToast:S}]=Object(T.a)()
if(Object(o.useEffect)(()=>{f&&S({type:"error",icon:W,message:$({id:"giftCards.errorRemoving",defaultMessage:"Unable to remove gift card. Please try again."}),dismissable:!0,timeout:7e3})},[S,f,$]),v)return d.a.createElement(F.a,null,d.a.createElement(s.a,{id:"giftCards.loading",defaultMessage:"Loading Gift Cards..."}))
const H=J?$({id:"giftCards.errorInvalid",defaultMessage:"Invalid card. Please try again."}):null
let K=null
if(i&&(K=d.a.createElement("span",{className:A.errorText},d.a.createElement(s.a,{id:"giftCards.errorLoading",defaultMessage:"There was an error loading applied gift cards. Please refresh and try again."}))),y.length>0){const a=y.map(a=>{const{code:e,current_balance:r}=a
return d.a.createElement(U,{code:e,currentBalance:r,isRemovingCard:x,key:e,removeGiftCard:M})})
K=d.a.createElement("div",{className:A.cards_container},a)}const q=J?A.card_input_container_error:A.card_input_container,X=d.a.createElement("div",{className:A.balance},t&&P?d.a.createElement("div",{className:A.price},d.a.createElement(s.a,{id:"giftCards.balance",defaultMessage:"Balance: "}),d.a.createElement(B.a,{value:t.balance.value,currencyCode:t.balance.currency})):d.a.createElement("span",{className:A.invalid_card_error},H)),Q=d.a.createElement("div",{className:A.card},d.a.createElement(N.a,{classes:{root:A.entry},id:A.card,label:$({id:"giftCards.cardNumber",defaultMessage:"Gift Card Number"})},d.a.createElement("div",{className:q},d.a.createElement(L.a,{id:A.card,disabled:h||k,field:"card",mask:a=>a&&a.trim(),maskOnBlur:!0,placeholder:$({id:"giftCards.cardEntry",defaultMessage:"Enter card number"}),validate:w.e})),d.a.createElement("span",{"aria-live":"polite"},X)),d.a.createElement(N.a,{classes:{label:A.applyLabel}},d.a.createElement(I.a,{priority:"normal",disabled:h,onClick:r,onKeyDown:_},d.a.createElement(s.a,{id:"giftCards.apply",defaultMessage:"Apply"}))),d.a.createElement(D.a,{className:A.check_balance_button,disabled:k,onClick:n,onKeyDown:c},d.a.createElement(s.a,{id:"giftCards.checkBalance",defaultMessage:"Check balance"})))
return d.a.createElement("div",{className:A.root},d.a.createElement("div",{className:A.entryForm},Q),K)}
var X=a=>d.a.createElement(g.b,null,d.a.createElement(q,a))},GVTQ:function(a,e,r){"use strict"
var t=r("JPst"),n=r.n(t)()(function(a){return a[1]})
n.push([a.i,".giftCard-card_info-TFA {\n}\n\n.giftCard-balance-b7r {\n}\n\n.giftCard-code-ZJO {\n}\n",""]),n.locals={card_info:"giftCard-card_info-TFA grid gap-y-2xs",balance:"giftCard-balance-b7r text-sm",code:"giftCard-code-ZJO"},e.a=n},KOss:function(a,e,r){"use strict"
var t=r("JPst"),n=r.n(t),c=r("G4iS"),i=n()(function(a){return a[1]})
i.i(c.a,"",!0),i.push([a.i,".linkButton-root-HUs {\n}\n",""]),i.locals={root:"linkButton-root-HUs "+c.a.locals.root+" font-semibold leading-tight max-w-full text-colorDefault text-brand-dark underline hover_text-colorDefault"},e.a=i},kXdO:function(a,e,r){"use strict"
var t=r("q1tI"),n=r.n(t),c=r("17x9"),i=r("cvoN"),o=r("dDsW")
const d=a=>{const{locale:e}=Object(o.a)(),{value:r,currencyCode:c,classes:d}=a,l=i.a.toParts.call(new Intl.NumberFormat(e,{style:"currency",currency:c}),r).map((a,e)=>{const r=d[a.type],t="".concat(e,"-").concat(a.value)
return n.a.createElement("span",{key:t,className:r},a.value)})
return n.a.createElement(t.Fragment,null,l)}
d.propTypes={classes:Object(c.shape)({currency:c.string,integer:c.string,decimal:c.string,fraction:c.string}),value:c.number.isRequired,currencyCode:c.string.isRequired},d.defaultProps={classes:{}},e.a=d},zLjX:function(a,e,r){"use strict"
var t=r("JPst"),n=r.n(t),c=r("KOss"),i=r("CJ7a"),o=n()(function(a){return a[1]})
o.i(c.a,"",!0),o.i(i.a,"",!0),o.push([a.i,".giftCards-root-Hgt {\n}\n\n.giftCards-errorText-5Vu {\n}\n\n.giftCards-balance-1JD {\n    grid-template-columns: max-content 1fr;\n}\n\n.giftCards-card-F61 {\n    grid-template-areas:\n        'card_entry'\n        'check_balance_button'\n        'apply_button';\n}\n\n@media (min-width: 960px) {\n    .giftCards-card-F61 {\n        grid-template-areas:\n            'card_entry apply_button'\n            'check_balance_button check_balance_button';\n    }\n}\n\n.giftCards-card_input_container-ogL {\n}\n\n.giftCards-invalid_card_error-nqo {\n    color: red;\n}\n\n/* TODO @TW: cannot compose */\n.giftCards-card_input_container_error-t6H input {\n    /* composes: border-error from global; */\n    border-color: rgb(var(--venia-global-color-red-400));\n}\n\n/* TODO @TW: cannot compose */\n.giftCards-card_input_container_error-t6H input:focus {\n    /* composes: border-gray-600 from global; */\n    border-color: rgb(var(--venia-global-color-gray-600));\n}\n\n/* TODO @TW: cannot compose */\n.giftCards-card_input_container_error-t6H p {\n    /* composes: text-error from global; */\n    color: rgb(var(--venia-global-color-error));\n    /* composes: font-semibold from global; */\n    font-weight: 600;\n}\n\n.giftCards-cards_container-ogd {\n    grid-template-columns: max-content auto;\n}\n\n.giftCards-check_balance_button-JRl {\n    grid-area: check_balance_button;\n}\n\n.giftCards-entry-e3g {\n    grid-area: card_entry;\n}\n\n.giftCards-price-k2T {\n}\n\n.giftCards-entryForm-XoW {\n}\n\n.giftCards-applyLabel-sGo {\n}\n",""]),o.locals={root:"giftCards-root-Hgt grid gap-md",errorText:"giftCards-errorText-5Vu leading-normal text-error",balance:"giftCards-balance-1JD grid italic items-start pt-1.5 text-sm",card:"giftCards-card-F61 gap-sm grid grid-cols-1 items-start lg_grid-cols-autoLast",card_input_container:"giftCards-card_input_container-ogL",invalid_card_error:"giftCards-invalid_card_error-nqo",card_input_container_error:"giftCards-card_input_container_error-t6H",cards_container:"giftCards-cards_container-ogd gap-sm grid items-baseline justify-start",check_balance_button:"giftCards-check_balance_button-JRl "+c.a.locals.root+" justify-self-center lg_justify-self-start",entry:"giftCards-entry-e3g",price:"giftCards-price-k2T",entryForm:"giftCards-entryForm-XoW",applyLabel:"giftCards-applyLabel-sGo "+i.a.locals.label+" hidden lg_block"},e.a=o}}])
